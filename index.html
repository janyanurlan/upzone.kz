<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Startup School | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
        }

        .avatar-upload {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
        }
        .avatar-preview {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            background-image: url('https://via.placeholder.com/120?text=–§–æ—Ç–æ');
            border: 3px solid var(--border-color);
        }
        .avatar-edit {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--primary-color);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            box-shadow: 0 2px 10px rgba(37, 99, 235, 0.3);
        }
        .info-item {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        .info-label { font-size: 12px; color: var(--text-muted); font-weight: bold; }
        .info-value { font-size: 16px; margin-top: 4px; }
    </style>
</head>
<body class="bg-gray-100 font-sans flex min-h-screen">

    <aside class="w-64 bg-slate-900 text-white flex flex-col fixed h-full">
        <div class="p-6 text-2xl font-bold border-b border-slate-700">
            üöÄ Startup <span class="text-blue-400">Hub</span>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <button onclick="showSection('learning')" id="nav-learning" class="w-full flex items-center space-x-3 p-3 rounded-xl hover:bg-slate-800 transition bg-slate-800">
                <span>üìö</span> <span>–û–±—É—á–µ–Ω–∏–µ</span>
            </button>
            <button onclick="showSection('profile')" id="nav-profile" class="w-full flex items-center space-x-3 p-3 rounded-xl hover:bg-slate-800 transition">
                <span>üë§</span> <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
            <button onclick="showSection('chat')" id="nav-chat" class="w-full flex items-center space-x-3 p-3 rounded-xl hover:bg-slate-800 transition">
                <span>üí¨</span> <span>–°–æ–æ–±—â–µ—Å—Ç–≤–æ</span>
            </button>
        </nav>
        <div class="p-4 border-t border-slate-700 text-xs text-slate-400">–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–µ–Ω</div>
    </aside>

    <div class="flex-1 ml-64 p-8">
        
        <section id="learning-section">
            <header class="max-w-6xl mx-auto mb-10 flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">–ü—Ä–∏–≤–µ—Ç, <span id="userGreeting">–°—Ç—É–¥–µ–Ω—Ç</span>!</h1>
                    <p class="text-gray-500">–ü—É—Ç—å –æ—Ç –∏–¥–µ–∏ –¥–æ –ø–µ—Ä–≤—ã—Ö –ø—Ä–æ–¥–∞–∂</p>
                </div>
                <div class="bg-white px-4 py-2 rounded-full shadow-sm border border-gray-200">
                    <span class="text-sm font-medium text-gray-600">–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="progressPercent" class="text-blue-600">0%</span></span>
                </div>
            </header>

            <main class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-blue-500 transition transform hover:-translate-y-1">
                    <div class="flex justify-between items-start mb-4">
                        <span class="bg-blue-100 text-blue-600 text-xs font-bold px-2.5 py-1 rounded">–≠–¢–ê–ü 1</span>
                        <span class="text-green-500 text-sm">üîì –î–æ—Å—Ç—É–ø–Ω–æ</span>
                    </div>
                    <h2 class="text-xl font-bold mb-2 text-gray-800">–ü–æ–∏—Å–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏–¥–µ–∏</h2>
                    <p class="text-gray-600 mb-6 text-sm">–£—á–∏–º—Å—è –Ω–∞—Ö–æ–¥–∏—Ç—å –±–æ–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Ö.</p>
                    <a href="lesson.html" class="block text-center w-full bg-blue-600 text-white font-semibold py-2 rounded-xl hover:bg-blue-700 transition">–ü–µ—Ä–µ–π—Ç–∏ –∫ —É—Ä–æ–∫—É</a>
                </div>

                <div id="stage2-card" class="bg-white p-6 rounded-2xl shadow-lg opacity-60 grayscale border-t-4 border-gray-300 transition transform">
                    <div class="flex justify-between items-start mb-4">
                        <span id="stage2-badge" class="bg-gray-100 text-gray-500 text-xs font-bold px-2.5 py-1 rounded">–≠–¢–ê–ü 2</span>
                        <span id="stage2-status" class="text-gray-400 text-sm">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</span>
                    </div>
                    <h2 class="text-xl font-bold mb-2 text-gray-800">–°–±–æ—Ä–∫–∞ MVP –Ω–∞ VS Code</h2>
                    <p class="text-gray-600 mb-6 text-sm">–°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ç–∞ –∑–∞ 48 —á–∞—Å–æ–≤.</p>
                    <button id="stage2-btn" disabled class="w-full bg-gray-200 text-gray-400 font-semibold py-2 rounded-xl cursor-not-allowed">–ü—Ä–æ–π–¥–∏—Ç–µ —ç—Ç–∞–ø 1</button>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg opacity-60 grayscale border-t-4 border-gray-300">
                    <div class="flex justify-between items-start mb-4">
                        <span class="bg-gray-100 text-gray-500 text-xs font-bold px-2.5 py-1 rounded">–≠–¢–ê–ü 3</span>
                        <span class="text-gray-400 text-sm">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</span>
                    </div>
                    <h2 class="text-xl font-bold mb-2 text-gray-800">–ü–µ—Ä–≤—ã–µ –ø—Ä–æ–¥–∞–∂–∏</h2>
                    <p class="text-gray-600 mb-6 text-sm">–ó–∞–ø—É—Å–∫–∞–µ–º —Ç—Ä–∞—Ñ–∏–∫ –∏ –ø–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–µ –¥–µ–Ω—å–≥–∏.</p>
                    <button disabled class="w-full bg-gray-200 text-gray-400 font-semibold py-2 rounded-xl cursor-not-allowed">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>
                </div>
            </main>
        </section>

        <section id="profile-section" class="hidden max-w-2xl mx-auto">
            <div class="bg-white p-8 rounded-3xl shadow-xl border border-gray-100 relative">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold" id="displayHeaderName">–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
                    <button onclick="toggleEditMode()" id="toggleBtn" class="text-blue-600 border border-blue-600 px-4 py-1 rounded-lg hover:bg-blue-50">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>

                <div class="profile-header">
                    <div class="avatar-upload">
                        <div id="imagePreview" class="avatar-preview"></div>
                        <label for="imageUpload" class="avatar-edit hidden" id="plusLabel">+</label>
                        <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" style="display: none;" />
                    </div>
                </div>

                <div id="profile-view-mode">
                    <div class="info-item"><div class="info-label">–ù–∏–∫–Ω–µ–π–º</div><div class="info-value font-bold text-blue-600" id="view-username">@not_set</div></div>
                    <div class="info-item"><div class="info-label">–§–∞–º–∏–ª–∏—è</div><div class="info-value" id="view-lastName">–ù–µ —É–∫–∞–∑–∞–Ω–æ</div></div>
                    <div class="info-item"><div class="info-label">Instagram</div><div class="info-value" id="view-insta">–ù–µ —É–∫–∞–∑–∞–Ω–æ</div></div>
                    <div class="info-item"><div class="info-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div><div class="info-value" id="view-direction">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div></div>
                    <div class="info-item"><div class="info-label">–û —Å–µ–±–µ</div><div class="info-value" id="view-bio">–ü—É—Å—Ç–æ</div></div>
                    <div id="survey-results-block" class="hidden mt-6 p-4 bg-blue-50 rounded-xl border border-blue-100">
                        <p class="text-xs font-bold text-blue-800 uppercase">–ò–¥–µ—è –∏–∑ –æ–±—É—á–µ–Ω–∏—è:</p>
                        <p class="text-sm italic" id="savedProblem">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>

                <form id="profile-edit-form" class="hidden space-y-4">
                    <div><label class="text-xs font-bold text-gray-500 uppercase">–ù–∏–∫–Ω–µ–π–º</label><input type="text" id="edit-username" class="w-full p-3 border rounded-xl outline-none focus:border-blue-500"></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase">–§–∞–º–∏–ª–∏—è</label><input type="text" id="edit-lastName" class="w-full p-3 border rounded-xl outline-none focus:border-blue-500"></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase">Instagram</label><input type="text" id="edit-insta" class="w-full p-3 border rounded-xl outline-none focus:border-blue-500"></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
                        <select id="edit-direction" class="w-full p-3 border rounded-xl outline-none">
                            <option value="none">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
                            <option value="hr">HRTech</option>
                            <option value="ai">AI & Data</option>
                            <option value="health">HealthTech</option>
                            <option value="other">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase">–û —Å–µ–±–µ</label><textarea id="edit-bio" rows="3" class="w-full p-3 border rounded-xl outline-none focus:border-blue-500"></textarea></div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </form>
            </div>
        </section>

        <section id="chat-section" class="hidden h-[calc(100vh-100px)]">
            <div class="bg-white p-10 rounded-3xl text-center shadow-lg">
                <h2 class="text-2xl font-bold mb-4">–°–æ–æ–±—â–µ—Å—Ç–≤–æ</h2>
                <p class="text-gray-500">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –ó–¥–µ—Å—å –±—É–¥–µ—Ç —á–∞—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</p>
            </div>
        </section>
    </div>

    <script>
        const SUPABASE_URL = 'https://dvwegmdyhjyihrxqvoiw.supabase.co';
        const SUPABASE_KEY = '–í–ê–®_–ö–õ–Æ–ß'; 
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const myId = '7943213b-6532-4b9c-bd10-4dcc4ae5d90c';

        const directionNames = {
            'hr': 'HRTech', 'ai': 'AI & Data', 'health': 'HealthTech', 'other': '–î—Ä—É–≥–æ–µ', 'none': '–ù–µ –≤—ã–±—Ä–∞–Ω–æ'
        };

        function showSection(id) {
            ['learning', 'profile', 'chat'].forEach(s => {
                document.getElementById(s + '-section').classList.add('hidden');
                document.getElementById('nav-' + s).classList.remove('bg-slate-800');
            });
            document.getElementById(id + '-section').classList.remove('hidden');
            document.getElementById('nav-' + id).classList.add('bg-slate-800');
        }

        let isEditMode = false;
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const view = document.getElementById('profile-view-mode');
            const edit = document.getElementById('profile-edit-form');
            const btn = document.getElementById('toggleBtn');
            const plus = document.getElementById('plusLabel');

            if (isEditMode) {
                view.classList.add('hidden');
                edit.classList.remove('hidden');
                btn.innerText = "–û—Ç–º–µ–Ω–∞";
                plus.classList.remove('hidden');
                document.getElementById('edit-username').value = document.getElementById('view-username').innerText.replace('@', '');
            } else {
                view.classList.remove('hidden');
                edit.classList.add('hidden');
                btn.innerText = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å";
                plus.classList.add('hidden');
            }
        }

        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').style.backgroundImage = `url(${e.target.result})`;
                    localStorage.setItem('userAvatar', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('profile-edit-form').onsubmit = async function(e) {
            e.preventDefault();
            const data = {
                username: document.getElementById('edit-username').value,
                lastName: document.getElementById('edit-lastName').value,
                insta: document.getElementById('edit-insta').value,
                direction: document.getElementById('edit-direction').value,
                bio: document.getElementById('edit-bio').value
            };
            localStorage.setItem('userProfileData', JSON.stringify(data));
            updateDisplay(data);
            toggleEditMode();
        };

        function updateDisplay(data) {
            if (!data) return;
            document.getElementById('view-username').innerText = data.username ? `@${data.username}` : '@not_set';
            document.getElementById('view-lastName').innerText = data.lastName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('view-insta').innerText = data.insta || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('view-direction').innerText = directionNames[data.direction] || '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
            document.getElementById('view-bio').innerText = data.bio || '–ü—É—Å—Ç–æ';
            document.getElementById('userGreeting').innerText = data.lastName || '–°—Ç—É–¥–µ–Ω—Ç';
            document.getElementById('displayHeaderName').innerText = data.lastName ? `–ü—Ä–æ—Ñ–∏–ª—å: ${data.lastName}` : "–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å";
        }

        window.addEventListener('load', () => {
            const savedData = JSON.parse(localStorage.getItem('userProfileData'));
            if (savedData) updateDisplay(savedData);

            const savedAvatar = localStorage.getItem('userAvatar');
            if (savedAvatar) document.getElementById('imagePreview').style.backgroundImage = `url(${savedAvatar})`;

            const survey = JSON.parse(localStorage.getItem('lastSurvey'));
            if (survey) {
                document.getElementById('savedProblem').innerText = survey.problem;
                document.getElementById('survey-results-block').classList.remove('hidden');

                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —ç—Ç–∞–ø–∞ 2
                const stage2Card = document.getElementById('stage2-card');
                const stage2Btn = document.getElementById('stage2-btn');
                if (stage2Card) {
                    stage2Card.classList.remove('opacity-60', 'grayscale', 'border-gray-300');
                    stage2Card.classList.add('border-blue-500');
                    stage2Btn.disabled = false;
                    stage2Btn.innerText = "–ü–µ—Ä–µ–π—Ç–∏ –∫ —É—Ä–æ–∫—É";
                    stage2Btn.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                    stage2Btn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    document.getElementById('stage2-status').innerText = "üîì –î–æ—Å—Ç—É–ø–Ω–æ";
                    document.getElementById('stage2-status').classList.replace('text-gray-400', 'text-green-500');
                    document.getElementById('progressPercent').innerText = "33%";
                }
            }
        });
    </script>
</body>
</html>